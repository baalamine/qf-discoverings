\documentclass[a4paper,10pt]{scrartcl}
\usepackage[utf8]{inputenc}
\usepackage{hyperref}
\renewcommand{\rmdefault}{ptm}
\usepackage{bera}% optional: just to have a nice mono-spaced font
\usepackage{listings}
\usepackage{xcolor}
\usepackage{csquotes}
\usepackage{booktabs}
\usepackage{amsfonts}

\colorlet{punct}{red!60!black}
\definecolor{background}{HTML}{EEEEEE}
\definecolor{delim}{RGB}{20,105,176}
\colorlet{numb}{magenta!60!black}

\lstdefinelanguage{json}{
    basicstyle=\normalfont\ttfamily,
    numbers=left,
    numberstyle=\scriptsize,
    stepnumber=1,
    numbersep=8pt,
    showstringspaces=false,
    breaklines=true,
    frame=lines,
    backgroundcolor=\color{background},
    literate=
     *{0}{{{\color{numb}0}}}{1}
      {1}{{{\color{numb}1}}}{1}
      {2}{{{\color{numb}2}}}{1}
      {3}{{{\color{numb}3}}}{1}
      {4}{{{\color{numb}4}}}{1}
      {5}{{{\color{numb}5}}}{1}
      {6}{{{\color{numb}6}}}{1}
      {7}{{{\color{numb}7}}}{1}
      {8}{{{\color{numb}8}}}{1}
      {9}{{{\color{numb}9}}}{1}
      {:}{{{\color{punct}{:}}}}{1}
      {,}{{{\color{punct}{,}}}}{1}
      {\{}{{{\color{delim}{\{}}}}{1}
      {\}}{{{\color{delim}{\}}}}}{1}
      {[}{{{\color{delim}{[}}}}{1}
      {]}{{{\color{delim}{]}}}}{1},
}
\newcommand{\lamine}[1]{\textcolor{blue}{#1}}
%opening
\title{DAFNA -- RestFul API for Truth Discovery Algorithms}
\subtitle{API DOCUMENTATION}
\author{Mouhamadou Lamine Ba\\ Hossam. H. HAMMADY\\ Laure BERTI-EQUILLE}
\date{\begin{tabular}{ll}Creation date:&November 5, 2015\\Revision date:&December 4, 2015\end{tabular}}

\begin{document}

\maketitle
\newpage
% tableofcontents
\tableofcontents
\newpage

% Introduction
\section{Introduction}
Data Forensics with Analytics, or for short DAFNA, is a project initiated by the Data Analytics Group in Qatar Computing Research Institute, 
Hamad Bin Khalifa University.
One of its various facets aims at providing efficient algorithms and tools for verifying the veracity of information provided by multiple conflicting
sources. The DAFNA API for truth discovery is a \emph{RestFul API} that enables end user applications to access and use twelve existing truth discovery algorithms
for fact checking and truth discovery when they have to integrate heterogeneous information coming from untrustworthy sources.  This documentation details
the use of the API for third-party applications.


% Authentication
\section{Authentication}
Third party developers wanting to test DAFNA API for truth discovery, or integrate it in their own applications,
need to first get the necessary access credentials. To obtain credentials, every 3rd party developer must
follows the process below.
\begin{itemize}
 \item Go to \href{http://dafna.qcri.org/users/sign_in}{AllegatorTrack}
 \item Register using a valid email id and email confirmation
 \item Contact DAFNA developers on \href{http://dafna.qcri.org/allegatortrack}{http://dafna.qcri.org/allegatortrack} for token access.
\end{itemize}
 Upon token access request done, the user will receive from DAFNA developpers the following access credentials.
\begin{itemize}
 \item \textbf{Authentication Token}: API user's access key
 \item \textbf{Encrypted Password}: user's secret key
\end{itemize}
% Request format
\section{Request Format}
% Scheme
\subsection{Scheme}
Requests to the API endpoints are done using plain HTTP. HTTPS is planned to be supported 
in the future development of the API for ensuring a more secure transmission of the Access 
Token.
% Methods
\subsection{Methods}
The current version of DAFNA API supports three HTTP Requests, i.e., \textbf{GET}, \textbf{POST}, and \textbf{DELETE}, 
with respect to the operations, for instance creation, listing, or removal of datasets, the 3rd party applications would
like to perform on the behalf on the client.
% Base Url
\subsection{Base URL}
The API is accessible through the following base URL.
\begin{itemize}
 \item \href{http://dafna.qrci.org/}{http://dafna.qrci.org/}
\end{itemize}
Every endpoint of the API must be appended to this given base URL.
For instance, to list the set of available datasets, client must use 
the following URL.
\begin{description}
\item GET \href{http://dafna.qcri.org/datasets/}{http://dafna.qcri.org/datasets/} 
\end{description}
% Request content type
\subsection{Request Content Type}
Either (1) \textquote{application/x-www-form-urlencoded} or (2) \textquote{application/json} can be used as the request content type (HTTP request \textquote{Content-Type}
header value). If (1) is used, all parameters should be encoded in the URL as a query string with proper escapes and separated by \&. If (2) is used, the request body should 
be a well-formed JSON object. 

\begin{enumerate}
 \item \textbf{url-encoded form}
\begin{description}
 \item POST \href{http://localhost:4000/runsets?checked\_algo=array\_of\_parameters}{http://dafna.qcri.org/runsets?checked\_algo=array\_of\_parameters}
\end{description}
 \item \textbf{json encoding}
\begin{description}
 \item POST \href{http://localhost:4000/runsets}{http://dafna.qcri.org/runsets}~
 \{checked\_algo: array\_of\_parameters, general\_config: array\_numerical\_values\}
\end{description}
\end{enumerate}

Note that when using some command line tools to issue your requests, the way the body content is passed could be slighted different.
For example, when a particular user issues requests through command lines via
\href{http://curl.haxx.se/}{\textquote{Curl}}, (1) and (2) argument passing techniques are respectively implemented as follows.
\begin{description}
 \item curl -X DELETE http://dafna.qcri.org/runsets/1/ -d \textquote{user\_token=some\_string\_here}\\
 \item and \\
 \item curl -X POST http://dafna.qcri.org/runsets -H ``Content-type: application/json" -d `\{\textquote{user\_token}: \textquote{some\_string\_here} , \textquote{checked\_algo}: \{\textquote{Accu}: [\textquote{0.2}, \textquote{0}, \textquote{100}, \textquote{0.5}, \textquote{false}, \textquote{true}, \textquote{true}, \textquote{false}] \}, \textquote{general\_config}:[\textquote{0.001}, \textquote{0.8}, \textquote{1}, \textquote{0.4}]\}' 
\end{description}
% Response format
\section{Response Format}
% http status code
\subsection{HTTP Status Codes}
\begin{itemize}
 \item \textbf{200:} Successful Requests (otherwise, an internal error will occur)
 \item \textbf{401:} Unauthorized Access, e.g., missing, invalid, or expired token
 \item \textbf{403:} Forbidden Access to the resource requested by the client
 \item \textbf{404:} Not Found Resource requested by the user
 \item \textbf{422:} Invalid Action on the accessed resource
 
\end{itemize}

% Response body format
\subsection{Response Body Format}
Responses to user queries are returned in JSON format. For now, JSON is the only supported format by the API for query output.
Further development might consider other formats such as XML.

% endpoints 
\section{Endpoints}
The current version of the API provides 8 endpoints, 4 among them are accessed via GET, 2 via POST, and 2 via DELETE:
% post endpoints
\subsection{POST Endpoints}
\begin{enumerate}
 \item \textbf{/datasets}
\begin{description}
 \item Requests the creation of a Dataset
\end{description}
\textbf{Parameters}
\begin{itemize}
\item \textbf{user\_token}: secret token provided to the client for authentication 
\item \textbf{s3\_key}: a file's s3 key if the file is uploaded at Amazon's s3 official. Right access to this bucket 
is needed.
\item \textbf{other\_url}: URL (other than the s3 key) if the dataset file is located somewhere else, e.g. in a local computer.
\item \textbf{kind}: either \textquote{claims} or \textquote{ground} corresponding to the different types of handled datasets
\item \textbf{original\_filename}: name of the uploaded file. It corresponds to any name that you want to give for identification
in future
\end{itemize}
\textbf{Response}
\begin{description}
 \item No data. 
 \item \textbf{200} status code when the request succeeds	
\end{description}
\textbf{Notes}
\begin{enumerate}
 \item One of \textbf{s3\_key} or \textbf{other\_url} parameters are mandatory for parsing dataset. 
 \item All uploaded files should be encoded in \textbf{UTF-8}.
 \item Be sure that your dataset respects the required format, i.e., it is a CSV file 
 having a header consisting of the following column names in order: \textbf{ObjectID},
 \textbf{PropertyID}, \textbf{PropertyValue}, \textbf{SourceID}, \textbf{TimeStamp}. 
 A sample example of datasets properly formatted for the API is available at:
 \href{http://daqcri.github.io/dafna/\#/dafna/exp\_sections/realworldDS/book.html}{\small{http://daqcri.github.io/dafna/\#/dafna/exp\_sections/realworldDS/book.html}}
 %Note that you can replace \textbf{PropertyValue} by \textbf{PropertyValues} and the system will automatically split the contents of this column on the comma when running multi-valued algorithms.
\end{enumerate}
%\lamine{POST not yet finish !}
%
 \item \textbf{/runsets}
 \begin{description}
 \item Creating a Runset, i.e., a truth discovery job over a given dataset
\end{description}
\textbf{Parameters}
\begin{itemize}
 \item \textbf{user\_token}: secret token provided to the client for authentication 
 \item  \textbf{checked\_algo}: set of algorithm name(s), each followed by an array of numerical values 
 for its different input parameters, e.g., \textquote{checked\_algo}: \{\textquote{Accu}: [\textquote{0.2}, \textquote{0}, \textquote{100}, \textquote{0.5}, \textquote{false}, \textquote{true}, \textquote{true}, \textquote{false}] , \textquote{Cosine}: [\textquote{1}, \textquote{0.2}] \}
specifies two algorithms \textbf{Accu} and \textbf{Cosine}
 \item \textbf{general\_config}: an array of numerical values, e.g., [\textquote{0.001}, \textquote{0.8}, \textquote{1}, \textquote{0.4}]
\end{itemize}
\textbf{Response}
\begin{description}
\item No data. 
 \item \textbf{200} status code when request succeed.	
\end{description}
\textbf{Notes}
\begin{enumerate}
 \item \textbf{checked\_algo} allows to specify the set of truth discovery algorithms along with the values of their input arguments to be used for the truth discovery process. At least one algorithm must be provided, and when several algorithms
 are specified their results are combined by the system for a better accuracy. We detail in Section~\ref{algorithms} the set of supported truth discovery algorithms together with their input arguments.
 %To see the details of all truth discovery algorithms supported by the API, please visit the following page: \href{http://daqcri.github.io/dafna/\#/dafna/exp\_sections/home.html}{http://daqcri.github.io/dafna/\#/dafna/exp\_sections/home.html}.
\item \textbf{general\_config} allows to specify the values of the general parameters of the runset, i.e., a given truth discovery job, such as the convergence thresold and the initial sources' trusworthiness scores.
 \end{enumerate}
\end{enumerate}

% get endpoints
\subsection{GET Endpoints}
\begin{enumerate}
 \item \textbf{/datasets}
\begin{description}
 \item Listing Datasets 
\end{description}
\textbf{Parameters}
\begin{itemize}
\item \textbf{user\_token}: secret token provided to the client for authentication
\item \textbf{kind}: either \textquote{claims} or \textquote{ground} which correspond to the different types of available datasets
\item \textbf{start}: an integer number specifying the index from which the listing of available datasets must start 
\item \textbf{length}: an integer specifying the maximum number of datasets to be listed
\end{itemize}
\textbf{Response}
\begin{description}
 \item \{DS$_1$, DS$_2$, $\ldots$, DS$_n$\} where every DS$_n$ is formatted as follows.\\ \\
 \{
  draw: $<$draw$>$,
  recordsTotal: $<$Number of Records$>$,
  recordsFiltered: $<$Number of filtered Records$>$,
  data: $<$data$>$,
  s3\_direct\_post: $<$date\_time$>$,
  fields: $<$date\_time$>$,
  key: $<$date\_time$>$,
  policy: $<$policy$>$,
  signature: $<$signatur$>$,
  success\_action\_status: $<$status$>$
\}\\ \\
\hspace*{-1cm} where $<$data$>$ contains all the information about to the available datasets.
\end{description}
\textsf{Notes}
\begin{enumerate}
 \item \textbf{start} and \textbf{length} parameters are optional. 
 \item When the parameter \textbf{kind} is not provided, the user will get an empty 
 set of datasets. 
 \item When the arguments \textbf{start} and \textbf{length} 
 are not specified, all the available datasets of the specified kind are returned.
\end{enumerate}

%
\item \textbf{/runsets}
\begin{description}
 \item Listing Runsets
\end{description}
\textbf{Parameters}
\begin{itemize}
 \item \textbf{user\_token}: secret token provided to the client for authentication
\end{itemize}
\textbf{Response:}
\begin{description}
 \item \{RS$_1$, RS$_2$, $\cdots$, RS$_n$\} where the format of RS$_n$ is:\\
\{
  id: $<$runset id$>$,
  created\_at: $<$Time of creation$>$,
  runs:[ 
\{
  id: $<$runset id$>$,
  algo: $<$Time of creation$>$,
  crated\_at: $<>$,
  status: $<$whether finished$>$,
  duration: $<$Duration of run$>$,
\}
,\{\},\{\}...]
\}	
\end{description}
%
\item \textbf{/runsets/<id>/results}
\begin{description}
 \item Listing Results of runsets having id=<id>
\end{description}
\textbf{Parameters}
\begin{itemize}
 \item \textbf{user\_token}: secret token provided to the client for authentication
 \item \textbf{id}: an existing identier of the runset whose results should be listed
\end{itemize}
\textbf{Response}
\begin{description}
 \item
 \{
  draw: $<$draw$>$,
  recordsTotal: $<$Total Number of Records$>$,
  recordsFiltered: $<$Filtered Records$>$,
  data: 

\}
\end{description}
%
\item \textbf{/runs}
\begin{description}
\item Listing Runs
\end{description}
\textbf{Parameters}
\begin{itemize}
 \item \textbf{user\_token}: secret token provided to the client for authentication
\end{itemize}
\textbf{Response}
\begin{description}
\item 
\{
  draw: $<$draw$>$,
  recordsTotal: $<$Total Number of Records$>$,
  recordsFiltered: $<$Filtered Records$>$,
  data:[ \{
  id: $<$run id$>$,
  algorithm: $<$Name of the algorithm$>$,
  created\_at: $<$Time of creation$>$,
  runset\_id: $<$Runset ID$>$,
  display: $<$Algorithm name and parameters in paranthesis (in order)$>$,
  status: $<$whether finished$>$,
  duration: $<$Duration of run$>$,
\}
,\{\},\{\}...]
\}	
\end{description}
\end{enumerate}

% post endpoints
\subsection{DELETE Endpoints}
\begin{enumerate}
\item \textbf{/datasets/<id>}
\begin{description}
 \item Deleting a Dataset having id=<id>
\end{description}
\textbf{Parameters}
\begin{itemize}
 \item \textbf{user\_token}: secret token provided to the client for authentication
 \item \textbf{id}: an existing identier of the dataset to be deleted 
\end{itemize}
\textbf{Response}
\begin{description}
 \item No data.
\item  \textbf{200} status code when the request succeeds.
\end{description}
%
\item \textbf{/runsets/<id>}
\begin{description}
\item Deleting a Runset having id=<id>
\end{description}
\textbf{Parameters}
\begin{itemize}
  \item \textbf{user\_token}: secret token provided to the client for authentication
 \item \textbf{id}: an existing identier of the runset to be deleted 
\end{itemize}
\textbf{Response}
\begin{description}
\item  No data.
\item \textbf{200} status code when the request succeeds.	
\end{description}
\end{enumerate}

% Algorithm names
\section{Supported Algorithms}\label{algorithms}
The main interest of using the API is to create a truth discovery job which is possible with an instantiation 
of a runset. Such a instantiation requires to specify one or more truth discovery algorithms to use through the
argument \textbf{checked\_algo}. We detail below (see Table~\ref{table:tfa}) the twelve truth discovery algorithms 
and their specific input parameters supported by DAFNA API.

\begin{table}[!ht]
\centering
\begin{tabular}{ll}
\toprule
\textbf{Name}&\textbf{Input Parameters}\\
\midrule
\textbf{Cosine}&\begin{tabular}{@{}l@{}}Initial Value Confidence $c\in[0,1]$\\ Prediction constant $\psi\in[0,1]$\\\end{tabular}\\
\hline \\
\textbf{2-Estimates}&\begin{tabular}{@{}l@{}}Normalization Factor $norm\in[0,1]$\\\end{tabular}\\
\hline \\
\textbf{3-Estimates}&\begin{tabular}{@{}l@{}}Initial Error Factor $\epsilon\in[0,1]$ \\Normalization Factor $norm\in[0,1]$\\ \end{tabular}\\
\hline \\
\textbf{Depen}&\begin{tabular}{@{}l@{}}Dependence a priori probability $p\in[0,1]$\\ Copied value probability $c\in[0,1]$\\Number of false values $n\in \mathbb{N}^{\ast}$\\\end{tabular}\\
\hline \\
\textbf{Accu}&\begin{tabular}{@{}l@{}}Dependence a priori probability $p\in[0,1]$\\ Copied value probability $c\in[0,1]$\\Number of false values $n\in \mathbb{N}^{\ast}$\\\end{tabular}\\
\hline \\      
\textbf{AccuSim}&\begin{tabular}{@{}l@{}}Dependence a priori probability $p\in[0,1]$\\ Copied value probability $c\in[0,1]$\\Number of false values $n\in \mathbb{N}^{\ast}$\\Similarity Constant $s\in[0,1]$\\\end{tabular}\\
\hline \\
\textbf{AccuNoDep}&\begin{tabular}{@{}l@{}}Copied value probability $c\in[0,1]$\\Number of false values $n\in \mathbb{N}^{\ast}$\\\end{tabular}\\
\hline \\
\textbf{TruthFinder}&\begin{tabular}{@{}l@{}}Similarity Constant $s\in[0,1]$\\Dampening Factor $d\in [0,1]$\\\end{tabular}\\
\hline \\
SimpleLCA&\begin{tabular}{@{}c@{}}Three \\ Drie\end{tabular}\\
GuessLCA&\begin{tabular}{@{}c@{}}Three \\ Drie\end{tabular}\\
MLE(multi-valued property values)&\begin{tabular}{@{}c@{}}Three \\ Drie\end{tabular}\\
LTM(multi-valued property values)&\begin{tabular}{@{}c@{}}Three \\ Drie\end{tabular}\\
\bottomrule
\end{tabular}
\caption{Truth Discovery Algorithms: Names and Input Parameters}\label{table:tfa}
\end{table}
% Job Monitoring 
\section{Monitoring Tasks Using Pusher}
Some of the jobs you submit (e.g. uploading datasets or running algorithm(s)) might take time to complete
for various reasons. Instead of letting users periodically pinging the server to verify the status of their
ongoing jobs, we provide a manner to make things easier for user applications by setting up a channel on \href{https://pusher.com/}{Pusher}.
User applications can subscribe to this channel in oder to be automatically notify for the events they have been binded to.
When any event like task completion occurs, a user applicaton will be notified of this. Kindly note that the unexpected
approach of repeatedly requesting run statuses rather than listening to the push messages will eventually overwhelm our 
server, and we may choose to suspend your account. So, please go through the documentation of Pusher to get a sense of how
things work. An client can subscribe to the notifications for her application using \textbf{app\_id = \textquote{79143}}.
To this end, a client needs to contact us for a key, which will be sent by email, to enable him to subscribe to the channel. Once you 
have configured your application using the app\_id and key, you can bind to particular events (see examples below), you wish to be notified for.

\begin{itemize}
 \item \textbf{channel.bind(`run\_change', function(run){}):} will notifiy in case of any change in the status of a run.
 \item \textbf{channel.bind(`dataset\_change', function(dataset){}):} will notify you in case of any change in the status of a dataset. 
\end{itemize}
You may find the following pages to be particularly useful:
\begin{enumerate}
 \item \href{https://pusher.com/docs/client_api_guide/client_channels}{Client Channel}
 \item \href{https://pusher.com/docs/client_api_guide/client_public_channels}{Client Public Channels}
 \item \href{https://pusher.com/docs/client_api_guide/client_connect}{Client Connect}
 \item \href{https://pusher.com/docs/client_api_guide/client_events}{Client Events}
\end{enumerate}

% AllegatorTrack application
\section{Online Tool: AllegatorTrack}
The main goal of DAFNA project is to design a scalable and accurate truth discovery system to score the veracity of information extracted from multiple 
online sources.  We design DAFNA API as the first proposed API that allows users to tests and compares a large class of well-known truth finding algorithms
on different scenarios and datasets. AllegatorTrack is the first application that uses DAFNA API and provides to users
an online plateform for testing the different features of the API. AllegatorTrack application is accessible via \href{http://dafna.qcri.org/users/sign\_in}{http://dafna.qcri.org/users/sign\_in}.

% Ongoing development
\section{Further Development}
Currently, the API is still in improvements and many new other aspects of truth finding and endpoints are still under investigation, based on recent
proposed development in the field, discussions with early adopter developers, and users' feedbacks. For example, the scheme may support HTTPS in the 
future, the response body format may support other output formatting like XML.Most importantly, the API must be extended in order to propose broader 
class of truth finding algorithms, in particular the new ones.
in the future.

% Questions or Feebacks
\section{Questions or Feebacks}
For any questions or feebacks about the API, please feel free to contact us by email on \href{mailto:lberti@qf.org.qa}{dafna.qf.org.qa}
or visit the website of the DAFNA project for more details by following the link below:
\href{http://daqcri.github.io/dafna/\#/dafna/home\_sections/home.html}{\small{http://daqcri.github.io/dafna/\#/dafna/home\_sections/home.html}}.

\end{document}